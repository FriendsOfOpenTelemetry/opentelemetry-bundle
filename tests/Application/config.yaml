framework:
  secret: ThisIsSecret
  test: true

services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: true

  GaelReyrol\OpenTelemetryBundle\Tests\Application\:
    resource: '%kernel.project_dir%/src'

open_telemetry:
  service:
    namespace: 'GaelReyrol'
    name: 'Symfony Application'
    version: '0.0.0'
    environment: '%kernel.environment%'

  instrumentation:
    kernel:
      trace_provider: main
    console:
      trace_provider: main
    http:
      enabled: false
    messenger: false
    mailer:
    profiler:

  traces:
    providers:
      noop:
        type: noop
      main:
        type: default
        sampler: always-on
        processor: simple
      traceable:
        type: traceable
        sampler: always-on
        processor: simple
      parent:
        sampler:
          parent_based: always-on
        processor: multi
      ratio:
        sampler:
          trace_id_ratio: 0.5
        processor: batch

    processors:
      noop:
        type: noop
      batch:
        type: batch
        clock: OpenTelemetry\SDK\Common\Time\SystemClock
        max_queue_size: 2048
        schedule_delay: 5000
        export_timeout: 30000
        max_export_batch_size: 512
        auto_flush: true
        exporter: zipkin
      multi:
        type: multi
        processors: [ 'simple', 'batch' ]
      simple:
        type: simple
        exporter: console

    exporters:
      in-memory: in-memory://
      console:
        type: stream
        dsn: php+json://stdout
      json:
        type: otlp
        dsn: http+json://localhost:4318/v1/traces
      ndjson:
        type: otlp
        dsn: http+ndjson://localhost:4318/v1/traces
      protobuf:
        type: otlp
        dsn: http+protobuf://localhost:4318/v1/traces
      grpc:
        type: grpc
        dns: http://localhost:4317
      zipkin:
        type: zipkin
        dsn: http+json://localhost:9411/api/v2/spans
  logs:
  metrics:

when@test:
  open_telemetry:
    traces:
      providers:
        main:
          sampler: always-on
          processor: simple

      processors:
        simple:
          type: simple
          exporter: in-memory

      exporters:
        in-memory: in-memory://
